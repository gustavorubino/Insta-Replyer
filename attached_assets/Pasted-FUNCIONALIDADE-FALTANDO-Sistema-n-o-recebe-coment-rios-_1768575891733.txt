FUNCIONALIDADE FALTANDO: Sistema n√£o recebe coment√°rios em posts do Instagram.

SITUA√á√ÉO ATUAL:
‚úÖ DMs (mensagens diretas) funcionam
‚ùå Coment√°rios em posts N√ÉO chegam

FUNCIONALIDADE NECESS√ÅRIA:

O sistema deve receber e responder:
1. DMs (Direct Messages) ‚úÖ J√° funciona
2. Coment√°rios em posts ‚ùå Precisa implementar
3. Coment√°rios em reels ‚ùå Precisa implementar

CORRE√á√ÉO NECESS√ÅRIA:

1. WEBHOOK - Adicionar subscription para coment√°rios:

Ao conectar Instagram (OAuth callback), registrar webhook para:
- messages (DMs) ‚úÖ J√° tem
- comments (coment√°rios) ‚Üê ADICIONAR
- mentions (men√ß√µes) ‚Üê ADICIONAR

C√≥digo no OAuth callback:

webhook_subscriptions = [
    "messages",      # DMs
    "comments",      # Coment√°rios em posts/reels
    "mentions"       # Men√ß√µes em stories
]

2. WEBHOOK HANDLER - Processar coment√°rios:

Adicionar l√≥gica para processar coment√°rios:

@app.route('/webhook/instagram', methods=['POST'])
def instagram_webhook():
    data = request.json
    
    for entry in data['entry']:
        # Processar DMs (j√° funciona)
        if 'messaging' in entry:
            process_direct_messages(entry['messaging'])
        
        # Processar COMENT√ÅRIOS (novo)
        if 'changes' in entry:
            for change in entry['changes']:
                if change['field'] == 'comments':
                    process_comment(change['value'])

3. FUN√á√ÉO process_comment:

def process_comment(comment_data):
    """
    Processa coment√°rios em posts/reels
    """
    comment_id = comment_data['id']
    post_id = comment_data['media']['id']
    user_id = comment_data['from']['id']
    username = comment_data['from']['username']
    text = comment_data['text']
    
    # Descobrir qual usu√°rio do sistema recebeu o coment√°rio
    # (dono do post)
    post_owner = get_post_owner(post_id)
    
    if not post_owner:
        return
    
    # Buscar perfil do comentarista
    profile = get_sender_profile(user_id, post_owner['user_email'])
    
    # Salvar coment√°rio na fila de aprova√ß√£o
    save_message(
        user_email=post_owner['user_email'],
        sender_id=user_id,
        message_text=text,
        sender_profile=profile,
        message_type='comment',  # ‚Üê Novo campo
        post_id=post_id,
        comment_id=comment_id
    )

4. BANCO DE DADOS - Adicionar campo message_type:

ALTER TABLE messages ADD COLUMN message_type TEXT DEFAULT 'dm';
ALTER TABLE messages ADD COLUMN post_id TEXT;
ALTER TABLE messages ADD COLUMN comment_id TEXT;

Valores poss√≠veis:
- 'dm' = Mensagem direta
- 'comment' = Coment√°rio em post/reel
- 'mention' = Men√ß√£o em story

5. FRONTEND - Mostrar tipo da mensagem:

Na fila de aprova√ß√£o, indicar:
- üí¨ DM
- üí≠ Coment√°rio em post
- üì¢ Men√ß√£o

6. RESPONDER COMENT√ÅRIO - API diferente:

Para responder DM:
POST https://graph.instagram.com/v18.0/me/messages

Para responder COMENT√ÅRIO:
POST https://graph.instagram.com/v18.0/{comment-id}/replies
Body: {
  "message": "Resposta aqui"
}

IMPORTANTE:
- Coment√°rios s√£o P√öBLICOS (todos veem)
- DMs s√£o PRIVADOS
- Interface deve deixar claro qual √© qual
- Usu√°rio deve aprovar antes de publicar coment√°rio p√∫blico

TESTE FINAL:
1. Conectar conta Instagram
2. Fazer post de teste
3. Comentar no post (de outra conta)
4. Verificar se coment√°rio aparece na fila de aprova√ß√£o
5. Aprovar resposta
6. Verificar se resposta aparece no Instagram

MOSTRE-ME o c√≥digo implementado para processar coment√°rios.
